// script.min.js - versão minificada (sem template literals)
const form = document.getElementById("entryForm"),
  titleInput = document.getElementById("title"),
  dateInput = document.getElementById("date"),
  descInput = document.getElementById("description"),
  entriesList = document.getElementById("entriesList"),
  emptyMsg = document.getElementById("emptyMsg"),
  installBtn = document.getElementById("installBtn"),
  STORAGE_KEY = "diario_de_bordo_entries_v1";
function loadEntries() {
  const raw = localStorage.getItem(STORAGE_KEY);
  try {
    return raw ? JSON.parse(raw) : [];
  } catch (e) {
    return console.error("Erro ao ler storage", e), [];
  }
}
function saveEntries(e) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(e));
}
function render() {
  const e = loadEntries();
  (entriesList.innerHTML = ""),
    0 === e.length
      ? (emptyMsg.hidden = !1)
      : ((emptyMsg.hidden = !0),
        e
          .slice()
          .reverse()
          .forEach(function (t) {
            const n = document.createElement("li");
            (n.className = "entry"),
              (n.innerHTML =
                '<div class="meta"><h3>' +
                escapeHtml(t.title) +
                '</h3><time datetime="' +
                t.date +
                '">' +
                formatDate(t.date) +
                "</time><p>" +
                escapeHtml(t.description) +
                '</p></div><div class="actions"><button class="small-btn" data-id="' +
                t.id +
                '" aria-label="Remover" title="Remover entrada">✕</button></div>'),
              entriesList.appendChild(n);
          })),
    Array.from(entriesList.querySelectorAll(".small-btn")).forEach(function (
      e
    ) {
      e.addEventListener("click", function () {
        const t = e.getAttribute("data-id");
        removeEntry(t);
      });
    });
}
function addEntry(e) {
  const t = loadEntries();
  t.push(e), saveEntries(t), render();
}
function removeEntry(e) {
  let t = loadEntries();
  (t = t.filter(function (t) {
    return t.id !== e;
  })),
    saveEntries(t),
    render();
}
form.addEventListener("submit", function (e) {
  e.preventDefault();
  const t = titleInput.value.trim(),
    n = dateInput.value,
    r = descInput.value.trim();
  if (!t || !n || !r) return void alert("Preencha todos os campos.");
  const o = { id: Date.now().toString(), title: t, date: n, description: r };
  addEntry(o), form.reset();
});
function escapeHtml(e) {
  return String(e).replace(/[&<>"']/g, function (e) {
    return {
      "&": "&amp;",
      "<": "&lt;",
      ">": "&gt;",
      '"': "&quot;",
      "'": "&#39;",
    }[e];
  });
}
function formatDate(e) {
  try {
    const t = new Date(e);
    return t.toLocaleDateString();
  } catch (e) {
    return e;
  }
}
"serviceWorker" in navigator &&
  navigator.serviceWorker
    .register("service-worker.js")
    .then(function () {
      console.log("Service Worker registrado");
    })
    .catch(function (e) {
      console.warn("Erro ao registrar SW", e);
    });
let deferredPrompt = null;
window.addEventListener("beforeinstallprompt", function (e) {
  e.preventDefault(), (deferredPrompt = e), (installBtn.hidden = !1);
}),
  installBtn.addEventListener("click", async function () {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const e = await deferredPrompt.userChoice;
    "accepted" === e.outcome
      ? console.log("Usuário aceitou a instalação")
      : console.log("Usuário recusou a instalação"),
      (deferredPrompt = null),
      (installBtn.hidden = !0);
  }),
  window.addEventListener("load", render);
